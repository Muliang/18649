; 18649 Fall 2013
; group 9
; Wenhui Hu (wenhuih), Yichao Xue(yichaox), Yujia Wang(yujiaw)
; DoorControl.cf	Author: Yichao Xue (yichaox)

;**************************************
;
;	     DoorControl.mf
;
;**************************************

#INCLUDE ElevatorDefines.mf

;Initialize
;Door Opened is false
;Door Closed is true
;mDoorReversal is false
;mAtFloor is false for F
;Dwell time is set
;Desired floor is not this floor
;HallCall and CarCall for this floor/hallway are false

0.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;

0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true;
0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true;
0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true;
0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true;

0.00s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = false;
0.00s I AT_FLOOR_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false;
0.00s I DISPATCHER_PERIOD N DESIRED_DWELL_[FRONT]_CAN_ID Integer = 2000;
0.00s I DRIVE_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = UP 25;
0.00s I WEIGHT_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 5;

0.00s I CAR_BUTTON_CONTROL_PERIOD N CAR_CALL_[3][FRONT]_CAN_ID CarCall 3 FRONT = false;
0.00s I HALL_BUTTON_CONTROL_PERIOD N HALL_CALL_[3][FRONT][UP]_CAN_ID HallCall 3 FRONT UP = false;

;#state 'S5.1 Closed'

+1.00s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSED;

;#transition 'T5.1'
;branch 1, speed = 0
+0.10s I AT_FLOOR_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = true;
+0.00s I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT UP;
+0.00s I DRIVE_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = UP 0;

;#state 'S5.2 Opening'

+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = false;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = false;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = false;

+0.50s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPENING;

;#transition 'T5.2' 
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.3 Open'
+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN;

;#transition 'T5.3'

;#state 'S5.4 Closing'
+0.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;
+12.00s A F DoorMotor FRONT LEFT : command == CLOSE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSING;

;#transition 'T5.5' 
;branch 1
+0.10s I WEIGHT_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 20000;

;#state 'S5.2 Opening'
+0.50s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPENING;

;#transition 'T5.2' 
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.3 Open'
+0.10s I WEIGHT_PERIOD N CAR_WEIGHT_CAN_ID CarWeight = 5;
+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN;

;#transition 'T5.3'

;#state 'S5.4 Closing'
+0.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;
+12.00s A F DoorMotor FRONT LEFT : command == CLOSE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSING;

;#transition 'T5.5' 
;branch 2
+0.00s I CAR_BUTTON_CONTROL_PERIOD N CAR_CALL_[3][FRONT]_CAN_ID CarCall 3 FRONT = true; 

;#state 'S5.2 Opening'
+0.50s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPENING;

+0.00s I CAR_BUTTON_CONTROL_PERIOD N CAR_CALL_[3][FRONT]_CAN_ID CarCall 3 FRONT = false; 


;#transition 'T5.2' 
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.3 Open'

+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN;

;#transition 'T5.3' 

;#state 'S5.4 Closing'
+0.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;
+12.00s A F DoorMotor FRONT LEFT : command == CLOSE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSING;

;#transition 'T5.5' 
;branch 3
+0.00s I HALL_BUTTON_CONTROL_PERIOD N HALL_CALL_[3][FRONT][UP]_CAN_ID HallCall 3 FRONT UP = true;

;#state 'S5.2 Opening'
+0.50s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPENING;
+0.00s I HALL_BUTTON_CONTROL_PERIOD N HALL_CALL_[3][FRONT][UP]_CAN_ID HallCall 3 FRONT UP = false;

;#transition 'T5.2' 
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.3 Open'

+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN;

;#transition 'T5.3' 

;#state 'S5.4 Closing'
+0.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;
+12.00s A F DoorMotor FRONT LEFT : command == CLOSE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSING;


+0.10s I AT_FLOOR_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = true;

+0.00s I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 6 FRONT UP;
+0.00s I DRIVE_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = UP 25;

;#transition 'T5.4'
+0.10s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true;

;#state 'S5.1 Closed'

+1.00s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSED;

;go to STATE_CLOSING

;#transition 'T5.1' 
;branch 2, direction = stop

+0.00s I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 3 FRONT STOP;
+0.00s I DRIVE_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = STOP 25;

;#state 'S5.2 Opening'


+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = false;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = false;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = false;

+0.50s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPENING;

;#transition 'T5.2' 
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.3 Open'
+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_OPEN;

;#transition 'T5.3'

;#state 'S5.4 Closing'
+0.00s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;
+12.00s A F DoorMotor FRONT LEFT : command == CLOSE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSING;

;#transition 'T5.6'
+0.00s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = true;

;#state 'S5.5 Reopening'
+0.50s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_REOPENING;

;#transition 'T5.7'
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.6 Reopen'
+0.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = false;

+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_REOPEN;

;#transition 'T5.8' 

;#state 'S5.7 Nudging'

+12.00s A F DoorMotor FRONT LEFT : command == NUDGE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_NUDGING;
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;

;#transition 'T5.9'
+0.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = true;

;#state 'S5.5 Reopening'
+0.10s A F DoorMotor FRONT LEFT : command == OPEN;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_REOPENING;

;go to nudging

;#transition 'T5.7'
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

;#state 'S5.6 Reopen'
+0.10s I DOOR_REVERSAL_NETWORK_PERIOD N DOOR_REVERSAL_SENSOR_[FRONT][LEFT]_CAN_ID DoorReversal FRONT LEFT = false;

+0.50s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_REOPEN;

;#transition 'T5.8' 

;#state 'S5.7 Nudging'

+12.00s A F DoorMotor FRONT LEFT : command == NUDGE;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_NUDGING;
+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true;

+0.10s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = false;

+0.10s I AT_FLOOR_PERIOD N AT_FLOOR_[3][FRONT]_CAN_ID AtFloor 3 FRONT = false;
+0.00s I DISPATCHER_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 6 FRONT UP;
+0.00s I DRIVE_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = UP 25;

;#transition 'T5.10'
+0.10s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true;
+0.00s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true;

;#state 'S5.1 Closed'
+1.00s A F DoorMotor FRONT LEFT : command == STOP;
+0.00s A S DoorControl[FRONT][LEFT] : STATE == STATE_CLOSED;










